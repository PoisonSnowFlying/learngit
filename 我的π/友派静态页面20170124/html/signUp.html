<!DOCTYPE html>
<head>
	<title>报名页面</title>
	<meta charset="utf-8">
	<link href="css/style.css" rel="stylesheet" type="text/css">
	<!--[if IE 7]>
	<link href="css/ie7.css" rel="stylesheet" type="text/css">
	<link href="css/common.css" rel="stylesheet" type="text/css">
	<![endif]-->
	<script src="./js/jquery-2.1.4.min.js"></script>
	<script src="./js/unslider-min.js"></script>
</head>
<body>
<div id="header">
	<div>
		<a href="index.html"> <img class="logo" src="images/logo.png" width="55.62" height="55.62" alt="">
			<p class="masthead-brand">友派</p></a>

		<ul class="navigation">
			<li>
				<a  href="index.html">首页</a>
			</li>
			<li>
				<a href="event.html">活动</a>
			</li>
			<li>
				<a href="about.html">关于</a>
			</li>
		</ul>
		<ul class="info">
			<li >
				<a href="login.html" >登录</a>
			</li>
			<li >
				<a href="register.html" >注册</a>
			</li>
		</ul>
	</div>

</div>
<div id="hdline" ></div>
<div class="signupPage">
	<div class="mainbox">
		<div class="content hdInfoBox">
			<h5>活动信息</h5>
			<div class="innerHdInfo">
				<p class="t"><a href="http://huodong.lvye.com/event/2553561/" target="_blank">非周末【天行户外】1.18【北京怀北国际滑雪场】全天不限时-免费教学-跟我们一起去吧！</a></p>
				<div class="d">
					<div class="hdDetail ">
						<ul class="clearfix">
							<li class="col25">
								<dl>
									<dt >开始日期：</dt>
									<dd>2016年11月26日</dd>
								</dl>
							</li>
							<li class="col25">
								<dl>
									<dt >结束日期：</dt>
									<dd>2016年11月26日</dd>
								</dl>
							</li>
							<li class="col25">
								<dl>
									<dt>出发地：</dt>
									<dd>北京</dd>
								</dl>
							</li>
							<li class="col25">
								<dl>
									<dt>目的地：</dt>
									<dd>河北</dd>
								</dl>
							</li>
						</ul>
					</div>
					<div class="hdDetail ">
						<ul class="clearfix">
							<li class="col25">
								<dl>
									<dt >类型：</dt>
									<dd>阿廖沙</dd>
								</dl>
							</li>
							<li class="col25">
								<dl>
									<dt >类型：</dt>
									<dd>阿廖沙</dd>
								</dl>
							</li>

							<li class="col25">
								<dl>
									<dt >类型：</dt>
									<dd>阿廖沙</dd>
								</dl>
							</li>

						</ul>
					</div>
					<div class="hdDetail ">
						<ul class="clearfix">
							<li class="col25">
								<dl>
									<dt >领队：</dt>
									<dd>阿廖沙</dd>
								</dl>
							</li>
							<li class="col75">
								<dl>
									<dt style="width:14%">集合地点：</dt>
									<dd class="horiwrap"><span>惠新西街</span><span>惠新西街</span><span>惠新西街</span></dd>
								</dl>
							</li>
						</ul>
					</div>


				</div>
			</div>
		</div>
		<div class="content hdCompanys">
			<h5>选择参与活动的小伙伴</h5>
			<div class="hdCompany clearfix">
				<div class="person marginR notselected" data-id="123">
					<div class="basicInfo">
						<ul class="clearfix">
							<li class="name">七胖</li>
							<li class="idCard" style="display:none">222222222222222</li>
						</ul>
					</div>
					<div class="line line-dashed "></div>
					<div class="otherInfo">
						<dl class="clearfix">
							<dt>性别：</dt>
							<dd class="sex">男</dd>
						</dl>
						<dl>
							<dt>电话号码：</dt>
							<dd class="phoneNumber">13818283848</dd>
						</dl>
					</div>
				</div>
				<div class="person marginR notselected " data-id="124">
					<div class="basicInfo">
						<ul class="clearfix">
							<li class="name">七胖</li>
							<li class="idCard" style="display:none">222222222222222</li>
						</ul>
					</div>
					<div class="line line-dashed "></div>
					<div class="otherInfo">
						<dl class="clearfix">
							<dt>性别：</dt>
							<dd class="sex">男</dd>
						</dl>
						<dl>
							<dt>电话号码：</dt>
							<dd class="phoneNumber">13818283848</dd>
						</dl>
					</div>
				</div>
				<div class="person marginR notselected" data-id="125">
					<div class="basicInfo">
						<ul class="clearfix">
							<li class="name">七胖</li>
							<li class="idCard" style="display:none">222222222222222</li>
						</ul>
					</div>
					<div class="line line-dashed "></div>
					<div class="otherInfo">
						<dl class="clearfix">
							<dt>性别：</dt>
							<dd class="sex">男</dd>
						</dl>
						<dl>
							<dt>电话号码：</dt>
							<dd class="phoneNumber">13818283848</dd>
						</dl>
					</div>
				</div>
				<div class="person notselected" data-id="126">
					<div class="basicInfo">
						<ul class="clearfix">
							<li class="name">七胖</li>
							<li class="idCard" style="display:none">222222222222222</li>
						</ul>
					</div>
					<div class="line line-dashed "></div>
					<div class="otherInfo">
						<dl class="clearfix">
							<dt>性别：</dt>
							<dd class="sex">男</dd>
						</dl>
						<dl>
							<dt>电话号码：</dt>
							<dd class="phoneNumber">13818283848</dd>
						</dl>
					</div>
				</div>
			</div>
		</div>
		<div class="content addBtn">
			<button id="addBtn">新增参与伙伴</button>
			<button id="managerBtn">管理参与人</button>
		</div>
		<div class="content hdHandle">
			<div class="personChoice">
				<table>
					<tr class="tableTitle" >
						<td >上车地点</td>
						<td >姓名</td>
						<td >性别</td>
						<td >手机号</td>
						<td >证件类型</td>
						<td >证件号码</td>
						<td >操作</td>
					</tr>
					<!--<tr class="tableInfo" data-id="123">-->
						<!--<td>-->
							<!--<select class="togetherPlace">-->
								<!--<option value="jmx">角门西</option>-->
								<!--<option value="hxxj">惠新西街</option>-->
								<!--<option value="css">慈寿寺</option>-->
							<!--</select>-->
						<!--</td>-->
						<!--<td>阿廖沙</td>-->
						<!--<td>男</td>-->
						<!--<td>88888888888</td>-->
						<!--<td>身份证</td>-->
						<!--<td>111111111111111111</td>-->
						<!--<td><a class="personDelete">删除</a></td>-->
					<!--</tr>-->
					<!--<tr class="tableInfo" data-id="124">-->
						<!--<td>-->
							<!--<select class="togetherPlace">-->
								<!--<option value="jmx">角门西</option>-->
								<!--<option value="hxxj">惠新西街</option>-->
								<!--<option value="css">慈寿寺</option>-->
							<!--</select>-->
						<!--</td>-->
						<!--<td>阿廖沙</td>-->
						<!--<td>男</td>-->
						<!--<td>88888888888</td>-->
						<!--<td>身份证</td>-->
						<!--<td>111111111111111111</td>-->
						<!--<td><a class="personDelete" >删除</a></td>-->
					<!--</tr>-->
				</table>
			</div>
		</div>
		<div class="content hdOrder">
			<h5>订单详情</h5>
			<div class="orderDetail">
				<table>
					<tr class="tableTitle">
						<td>活动名称</td>
						<td>领队</td>
						<td>单价</td>
						<td>参与人数</td>
						<td>小计</td>
					</tr>
					<tr class="tableInfo">
						<td class="hdName">非周末【天行户外】1.18【北京怀北国际滑雪场】全天不限时-免费教学-跟我们一起去吧！</td>
						<td>阿廖沙</td>
						<td id="price">120</td>
						<td id="signupNumber">1</td>
						<td id="countMoney">120</td>
					</tr>
				</table>
			</div>
		</div>
		<div class="content other">
			<div class="message clearfix">
				<div class="toLeader">
					<dl class="clearfix">
						<dt>给领队的话：</dt>
						<dd class="word"><input value=""/></dd>
					</dl>
				</div>
				<div class="insurance">
					<dl class="clearfix">
						<dt>保险：</dt>
						<dd class="price"><input checked="checked"  id='insurance' type="checkbox"/><span>每人5.00元</span></dd>
						<dd class="count"><span id="insurancePrice">5</span></dd>
					</dl>
				</div>
			</div>
		</div>
		<div class="content countMoney">
			<div class="sum clearfix">
				<dl class="clearfix">
					<dt>总计：</dt>
					<dd><span id="allMoney">125.00</span></dd>
				</dl>
			</div>
			<div class="submit clearfix">
				<button id="subBtn" onclick="location='orderConfirm.html'">提交信息</button>
			</div>
		</div>
	</div>
</div>
<div id="footer">
	<div>
		<div class="section">
			<div>
				<div>
					<ul>
						<li class="first">
							<h2>关于我们</h2>
							<p>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;友派是一个泛娱乐化的社交平台，力图创建一个以年轻人的兴趣、爱好为中心，以线上线下结合为立足点的文化社区。友派倡导勇于尝试、乐于参与、积极分享的社交理念，旨在提供一种健康有营养的生活方式，希望能给大家带来更加丰富和精彩的人生体验。
							</p>
						</li>
						<!-- <li>
                            <h2>联系我们</h2>
                            <ul class="connect">
                                <li>
                                    <a href="#go/facebook/" class="facebook">&nbsp;</a>
                                </li>
                                <li>
                                    <a href="#go/twitter/" class="twitter">&nbsp;</a>
                                </li>
                                <li>
                                    <a href="#misc/contact" class="googleplus">&nbsp;</a>
                                </li>
                            </ul>
                        </li> -->
					</ul>
				</div>
			</div>
		</div>
		<div class="footnote">
			<p>
				&copy; Copyright 2017. All rights reserved.&nbsp;
			</p>
		</div>
	</div>
</div>
<script>
	$(function () {
		var companys = $('.hdCompany');
		var personContainer = $('.hdHandle .personChoice ');
		var personInfoArr = ['name','sex','phoneNumber','idCard'];
		var insuranceFlag = true;
		// 添加参与人员
		companys.on('click','div.person',function (event) {
			var self = this;
			signUpClickFn(event,self);
		});
		// 动态绑定，删除按钮删除当前选择的人员
		personContainer.on('click','.personDelete',function (event) {
			$(this).parents('.tableInfo').remove();
			var personId = $(this).parents('.tableInfo').data('id');
			companys.find('.person[data-id=' + personId + ']').toggleClass('notselected selected');
			calculatorFn(insuranceFlag);
		});
		// 保险选择事件
		$('#insurance').on('click',function () {
			if($(this).prop('checked')) {
				insuranceFlag = true;
				calculatorFn(insuranceFlag);
				$(this).prop('checked',true);
			} else {
				$(this).prop('checked',false);
				insuranceFlag = false;
				calculatorFn(insuranceFlag);

			}
		});

		/**
		 *
		 * @param event  点击事件对象
		 * @param self   代理元素ele
		 */
		function signUpClickFn (event,self) {
			var flag = false;
			var personId = $(self).data('id');
			console.log(personId);
			var personInfo = getPersonInfoFn(self);
			$.each(personContainer.find('.tableInfo'),function (index,ele) {
//				console.log(personId);
				if($(ele).data('id') === personInfo.data) {
					$(this).remove();
					companys.find('.person[data-id=' + personInfo.data + ']').toggleClass('notselected selected');
					calculatorFn(insuranceFlag);
					flag = true;

				}
			});
			if(!flag) {
				addCompanyFn(self,personInfo);
				calculatorFn(insuranceFlag);
			}
		}

		/**
		 *
		 * @param ele 代理元素ele
		 * @returns {{}} 代理元素的信息对象包括name,sex,phoneNumber,idCard
		 */
		function getPersonInfoFn(ele) {
			var obj = {};
			ele && personInfoArr.forEach(function (item,index) {
				obj[item]= $(ele).find('.' + item).text();
			});
			obj['data'] = $(ele).data('id');
			return obj;
		}

		/**
		 *
		 * @param self 点击事件对象
		 * @param personInfo 点击事件对象的基本信息对象
		 */
		function addCompanyFn (self,personInfo) {
			var fragment = '<tr class="tableInfo" data-id= '+ personInfo.data + '>' +
					'<td>' +
					'<select class="togetherPlace"> ' +
					'<option value="jmx">角门西</option> ' +
					'<option value="hxxj">惠新西街</option> ' +
					'<option value="css">慈寿寺</option> ' +
					'</select> ' +
					'</td> ' +
					'<td class="name">' + personInfo["name"] + '</td> ' +
					'<td class="sex">' + personInfo["sex"] + '</td> ' +
					'<td class="phoneNumber">' + personInfo["phoneNumber"] + '</td> ' +
					'<td>身份证</td> ' +
					'<td class="idCard">' + personInfo["idCard"] + '</td> ' +
					'<td><a class="personDelete" >删除</a></td>' +
					'</tr>';
			personContainer.find('table').append($(fragment));
			$(self).toggleClass('notselected selected');
		}

		function calculatorFn (insuranceFlag) {
			var personNumber = personContainer.find('.tableInfo').length + 1;
			var price = $("#price").text();
			var insurancePrice = $('#insurancePrice').text();
			var allMoney,countMoney;
			countMoney = personNumber * price;
			allMoney = countMoney;
			if(insuranceFlag) {
				allMoney = countMoney + personNumber * insurancePrice;
			}
			$('#signupNumber').text(personNumber);
			$("#countMoney").text(countMoney.toFixed(2));
			$("#allMoney").text(allMoney.toFixed(2));
			// 获取
		}
	});
</script>
</body>
</html>